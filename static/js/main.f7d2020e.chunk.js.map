{"version":3,"sources":["constants.js","Yolo.js","App.js","index.js"],"names":["names","tf","require","Yolo","state","model","preview","predictions","onDrop","accepted","rejected","links","_this","setState","cropToCanvas","image","canvas","ctx","naturalWidth","naturalHeight","clearRect","width","height","fillStyle","fillRect","ratio","Math","min","newWidth","round","newHeight","drawImage","onImageChange","e","c","document","getElementById","getContext","target","_this$state$model$inp","inputs","shape","slice","_this$state$model$inp2","Object","slicedToArray","modelWidth","modelHeight","input","tidy","resizeBilinear","browser","fromPixels","div","expandDims","executeAsync","then","res","font","textBaseline","i","_res","boxes","scores","classes","valid_detections","boxes_data","dataSync","scores_data","classes_data","valid_detections_data","dispose","_boxes_data$slice","_boxes_data$slice2","x1","y1","x2","y2","klass","score","toFixed","strokeStyle","lineWidth","strokeRect","textWidth","measureText","textHeight","parseInt","_boxes_data$slice3","_boxes_data$slice4","fillText","_callee","_this2","this","_regeneratorRuntime","wrap","_context","prev","next","loadGraphModel","catch","err","console","error","stop","react_default","a","createElement","className","build_default","accept","multiple","alt","onLoad","src","id","React","Component","App","src_Yolo","ReactDOM","render","StrictMode","src_App"],"mappings":"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","file":"static/js/main.f7d2020e.chunk.js","sourcesContent":["export const names = [\r\n  \"person\",\r\n  \"bicycle\",\r\n  \"car\",\r\n  \"motorcycle\",\r\n  \"airplane\",\r\n  \"bus\",\r\n  \"train\",\r\n  \"truck\",\r\n  \"boat\",\r\n  \"traffic light\",\r\n  \"fire hydrant\",\r\n  \"stop sign\",\r\n  \"parking meter\",\r\n  \"bench\",\r\n  \"bird\",\r\n  \"cat\",\r\n  \"dog\",\r\n  \"horse\",\r\n  \"sheep\",\r\n  \"cow\",\r\n  \"elephant\",\r\n  \"bear\",\r\n  \"zebra\",\r\n  \"giraffe\",\r\n  \"backpack\",\r\n  \"umbrella\",\r\n  \"handbag\",\r\n  \"tie\",\r\n  \"suitcase\",\r\n  \"frisbee\",\r\n  \"skis\",\r\n  \"snowboard\",\r\n  \"sports ball\",\r\n  \"kite\",\r\n  \"baseball bat\",\r\n  \"baseball glove\",\r\n  \"skateboard\",\r\n  \"surfboard\",\r\n  \"tennis racket\",\r\n  \"bottle\",\r\n  \"wine glass\",\r\n  \"cup\",\r\n  \"fork\",\r\n  \"knife\",\r\n  \"spoon\",\r\n  \"bowl\",\r\n  \"banana\",\r\n  \"apple\",\r\n  \"sandwich\",\r\n  \"orange\",\r\n  \"broccoli\",\r\n  \"carrot\",\r\n  \"hot dog\",\r\n  \"pizza\",\r\n  \"donut\",\r\n  \"cake\",\r\n  \"chair\",\r\n  \"couch\",\r\n  \"potted plant\",\r\n  \"bed\",\r\n  \"dining table\",\r\n  \"toilet\",\r\n  \"tv\",\r\n  \"laptop\",\r\n  \"mouse\",\r\n  \"remote\",\r\n  \"keyboard\",\r\n  \"cell phone\",\r\n  \"microwave\",\r\n  \"oven\",\r\n  \"toaster\",\r\n  \"sink\",\r\n  \"refrigerator\",\r\n  \"book\",\r\n  \"clock\",\r\n  \"vase\",\r\n  \"scissors\",\r\n  \"teddy bear\",\r\n  \"hair drier\",\r\n  \"toothbrush\",\r\n];\r\n\r\nexport const weights = \"http://localhost:3000/web_model/model.json\";\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport MagicDropzone from \"react-magic-dropzone\";\r\nimport \"./styles.css\";\r\nimport { names, weights } from \"./constants\";\r\nconst tf = require(\"@tensorflow/tfjs\");\r\n\r\nclass Yolo extends React.Component {\r\n  state = {\r\n    model: null,\r\n    preview: \"\",\r\n    predictions: [],\r\n  };\r\n\r\n  async componentDidMount() {\r\n    await tf\r\n      .loadGraphModel(weights)\r\n      .then((model) => {\r\n        this.setState({\r\n          model: model,\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        console.error(err);\r\n      });\r\n  }\r\n\r\n  onDrop = (accepted, rejected, links) => {\r\n    this.setState({ preview: accepted[0].preview || links[0] });\r\n  };\r\n\r\n  cropToCanvas = (image, canvas, ctx) => {\r\n    const naturalWidth = image.naturalWidth;\r\n    const naturalHeight = image.naturalHeight;\r\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n    ctx.fillStyle = \"#000000\";\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n    const ratio = Math.min(\r\n      canvas.width / image.naturalWidth,\r\n      canvas.height / image.naturalHeight\r\n    );\r\n    const newWidth = Math.round(naturalWidth * ratio);\r\n    const newHeight = Math.round(naturalHeight * ratio);\r\n    ctx.drawImage(\r\n      image,\r\n      0,\r\n      0,\r\n      naturalWidth,\r\n      naturalHeight,\r\n      (canvas.width - newWidth) / 2,\r\n      (canvas.height - newHeight) / 2,\r\n      newWidth,\r\n      newHeight\r\n    );\r\n  };\r\n\r\n  onImageChange = (e) => {\r\n    const c = document.getElementById(\"canvas\");\r\n    const ctx = c.getContext(\"2d\");\r\n    this.cropToCanvas(e.target, c, ctx);\r\n\r\n    let [modelWidth, modelHeight] = this.state.model.inputs[0].shape.slice(\r\n      1,\r\n      3\r\n    );\r\n    const input = tf.tidy(() => {\r\n      return tf.image\r\n        .resizeBilinear(tf.browser.fromPixels(c), [modelWidth, modelHeight])\r\n        .div(255.0)\r\n        .expandDims(0);\r\n    });\r\n    this.state.model.executeAsync(input).then((res) => {\r\n      const font = \"16px sans-serif\";\r\n      ctx.font = font;\r\n      ctx.textBaseline = \"top\";\r\n\r\n      const [boxes, scores, classes, valid_detections] = res;\r\n      const boxes_data = boxes.dataSync();\r\n      const scores_data = scores.dataSync();\r\n      const classes_data = classes.dataSync();\r\n      const valid_detections_data = valid_detections.dataSync()[0];\r\n\r\n      tf.dispose(res);\r\n\r\n      var i;\r\n      for (i = 0; i < valid_detections_data; ++i) {\r\n        let [x1, y1, x2, y2] = boxes_data.slice(i * 4, (i + 1) * 4);\r\n        x1 *= c.width;\r\n        x2 *= c.width;\r\n        y1 *= c.height;\r\n        y2 *= c.height;\r\n        const width = x2 - x1;\r\n        const height = y2 - y1;\r\n        const klass = names[classes_data[i]];\r\n        const score = scores_data[i].toFixed(2);\r\n\r\n        ctx.strokeStyle = \"#00FFFF\";\r\n        ctx.lineWidth = 4;\r\n        ctx.strokeRect(x1, y1, width, height);\r\n\r\n        ctx.fillStyle = \"#00FFFF\";\r\n        const textWidth = ctx.measureText(klass + \":\" + score).width;\r\n        const textHeight = parseInt(font, 10);\r\n        ctx.fillRect(x1, y1, textWidth + 4, textHeight + 4);\r\n      }\r\n      for (i = 0; i < valid_detections_data; ++i) {\r\n        let [x1, y1, ,] = boxes_data.slice(i * 4, (i + 1) * 4);\r\n        x1 *= c.width;\r\n        y1 *= c.height;\r\n        const klass = names[classes_data[i]];\r\n        const score = scores_data[i].toFixed(2);\r\n\r\n        ctx.fillStyle = \"#000000\";\r\n        ctx.fillText(klass + \":\" + score, x1, y1);\r\n      }\r\n    });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"Dropzone-page\">\r\n        {this.state.model ? (\r\n          <MagicDropzone\r\n            className=\"Dropzone\"\r\n            accept=\"image/jpeg, image/png, .jpg, .jpeg, .png\"\r\n            multiple={false}\r\n            onDrop={this.onDrop}\r\n          >\r\n            {this.state.preview ? (\r\n              <img\r\n                alt=\"upload preview\"\r\n                onLoad={this.onImageChange}\r\n                className=\"Dropzone-img\"\r\n                src={this.state.preview}\r\n              />\r\n            ) : (\r\n              \"Choose or drop a file.\"\r\n            )}\r\n            <canvas id=\"canvas\" width=\"640\" height=\"640\" />\r\n          </MagicDropzone>\r\n        ) : (\r\n          <div className=\"Dropzone\">Loading model...</div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Yolo;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport \"./styles.css\";\r\nimport Yolo from \"./Yolo\";\r\n\r\nconst App = () => {\r\n  return <Yolo />;\r\n};\r\n\r\nexport default App;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport \"./styles.css\";\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}